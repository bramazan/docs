---
title: Common Errors
description: Solutions for frequently encountered errors in Ödeal Payment Infrastructure integration
icon: 'triangle-exclamation'
---

# Common Errors & Solutions

Quick solutions for the most frequently encountered errors when integrating with Ödeal Payment Infrastructure.

## Authentication Errors

### UNAUTHORIZED (401)

**Error Message**: `Invalid or missing API key`

**Causes**:
- Missing `Authorization` header
- Invalid API key format
- Expired or revoked API key
- Using test key in production (or vice versa)

**Solutions**:

<CodeGroup>

```javascript Check Header
// ✅ Correct
headers: {
  'Authorization': 'Bearer sk_live_abc123...'
}

// ❌ Wrong
headers: {
  'X-API-Key': 'sk_live_abc123...' // Wrong header name
}
```

```bash Verify Environment
# Test environment
Authorization: Bearer sk_test_...

# Production environment
Authorization: Bearer sk_live_...
```

</CodeGroup>

<Tip>
Always use **environment variables** for API keys - never hardcode them!
</Tip>

---

### FORBIDDEN (403)

**Error Message**: `Insufficient permissions`

**Causes**:
- API key doesn't have required permissions
- Trying to access another merchant's resources
- Feature not enabled for your account

**Solutions**:
1. Verify API key permissions in dashboard
2. Ensure you're using correct merchant ID
3. Contact support to enable required features

---

## Payment Errors

### CARD_DECLINED

**Error Code**: `CARD_DECLINED`

**Possible Reasons**:
- Insufficient funds
- Card issuer declined
- Fraud prevention triggered
- Card not activated for online payments

**Solutions**:

```javascript
// Provide clear error message to user
if (error.code === 'CARD_DECLINED') {
  showError(
    'Your card was declined. Please try a different card or contact your bank.'
  );
}
```

**Best Practices**:
- Don't retry immediately (will likely fail again)
- Suggest alternative payment methods
- Provide customer support contact

---

### INSUFFICIENT_FUNDS

**Error Code**: `INSUFFICIENT_FUNDS`

**Solutions**:

```javascript
if (error.code === 'INSUFFICIENT_FUNDS') {
  showError(
    'Your card has insufficient funds. Please use a different card.'
  );
  
  // Optionally suggest reducing amount
 if (allowPartialPayment) {
    suggestPartialPayment(availableFunds);
  }
}
```

---

### EXPIRED_CARD

**Error Code**: `EXPIRED_CARD`

**Solutions**:

```javascript
// Validate expiry before submitting
function validateExpiry(month, year) {
  const now = new Date();
  const expiry = new Date(2000 + parseInt(year), parseInt(month) - 1);
  
  if (expiry < now) {
    throw new Error('Card has expired');
  }
}
```

---

### INVALID_CVV

**Error Code**: `INVALID_CVV`

**Solutions**:

```javascript
// Validate CVV format
function validateCVV(cvv, cardType) {
  if (cardType === 'AMEX') {
    return /^\d{4}$/.test(cvv); // 4 digits for Amex
  }
  return /^\d{3}$/.test(cvv); // 3 digits for others
}
```

---

### CURRENCY_NOT_SUPPORTED

**Error Code**: `CURRENCY_NOT_SUPPORTED`

**Causes**:
- Currency not enabled for your merchant account
- Bank doesn't support the currency
- Invalid currency code

**Solutions**:

```javascript
const supportedCurrencies = ['TRY', 'USD', 'EUR'];

if (!supportedCurrencies.includes(currency)) {
  throw new Error(`Currency ${currency} not supported`);
}
```

---

## Request Errors

### INVALID_REQUEST (400)

**Error Code**: `VALIDATION_ERROR`

**Common Validation Errors**:

<AccordionGroup>
  <Accordion title="Missing Required Field">
    ```json
    {
      "error": {
        "code": "VALIDATION_ERROR",
        "message": "merchantId is required",
        "field": "merchantId"
      }
    }
    ```
    
    **Solution**: Ensure all required fields are included in request
  </Accordion>
  
  <Accordion title="Invalid Amount">
    ```json
    {
      "error": {
        "code": "INVALID_AMOUNT",
        "message": "Amount must be greater than 0"
      }
    }
    ```
    
    **Solution**: 
    - Amount must be > 0
    - Use decimal format (e.g., 100.00, not 10000)
    - Maximum 2 decimal places
  </Accordion>
  
  <Accordion title="Invalid Card Number">
    ```javascript
    // Validate with Luhn algorithm
    function luhnCheck(cardNumber) {
      const digits = cardNumber.replace(/\D/g, '').split('').map(Number);
      let sum = 0;
      let isEven = false;
      
      for (let i = digits.length - 1; i >= 0; i--) {
        let digit = digits[i];
        
        if (isEven) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        
        sum += digit;
        isEven = !isEven;
      }
      
      return sum % 10 === 0;
    }
    ```
  </Accordion>
  
  <Accordion title="Invalid Date Format">
    **Error**: `Invalid expiryMonth or expiryYear`
    
    **Correct Format**:
    ```javascript
    {
      "expiryMonth": "12",  // String, 2 digits
      "expiryYear": "2025"  // String, 4 digits
    }
    ```
    
    **Incorrect**:
    ```javascript
    {
      "expiryMonth": 12,       // ❌ Number
      "expiryYear": "25"       // ❌ 2 digits
    }
    ```
  </Accordion>
</AccordionGroup>

---

### IDEMPOTENCY_KEY_REUSED

**Error Code**: `IDEMPOTENCY_CONFLICT`

**Cause**: Same idempotency key used for different request body

**Solutions**:

```javascript
// Generate unique key per unique request
function generateIdempotencyKey(orderId, amount) {
  return `order-${orderId}-${amount}-${Date.now()}`;
}

// On retry with SAME request, use SAME key
const idempotencyKey = sessionStorage.getItem('payment-key') || 
                       generateIdempotencyKey(orderId, amount);
                       
sessionStorage.setItem('payment-key', idempotencyKey);
```

---

### RATE_LIMIT_EXCEEDED (429)

**Error Message**: `Too many requests`

**Solutions**:

```javascript
async function callAPIWithRetry(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.status === 429) {
        const retryAfter = error.headers['Retry-After'] || Math.pow(2, i);
        await sleep(retryAfter * 1000);
        continue;
      }
      throw error;
    }
  }
}
```

<Info>
Rate limit headers are included in every response:
- `X-RateLimit-Limit`: Your rate limit
- `X-RateLimit-Remaining`: Requests remaining
- `X-RateLimit-Reset`: Unix timestamp when limit resets
</Info>

---

## Network Errors

### REQUEST_TIMEOUT

**Cause**: Request took longer than 30 seconds

**Solutions**:

```javascript
// Set appropriate timeout
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 30000);

try {
  const response = await fetch('/v1/payments', {
    signal: controller.signal,
    ...options
  });
} catch (error) {
  if (error.name === 'AbortError') {
    // Handle timeout
    showError('Request timed out. Please try again.');
  }
} finally {
  clearTimeout(timeoutId);
}
```

---

### NETWORK_ERROR

**Causes**:
- No internet connection
- DNS failure
- Firewall blocking

**Solutions**:

```javascript
async function safeAPICall(fn) {
  try {
    return await fn();
  } catch (error) {
    if (!navigator.onLine) {
      showError('No internet connection. Please check your network.');
      return;
    }
    
    // Retry with exponential backoff
    return retryWithBackoff(fn, 3);
  }
}
```

---

## 3D Secure Errors

### THREEDS_AUTHENTICATION_FAILED

**Error Code**: `3DS_FAILED`

**Causes**:
- Customer cancelled authentication
- Authentication timeout
- Bank's 3DS system error

**Solutions**:

```javascript
if (error.code === '3DS_FAILED') {
  // Allow retry
  showError(
    '3D Secure authentication failed. Would you like to try again?'
  );
  
  // Optionally try non-3DS if eligible
  if (canBypass3DS) {
    offerNon3DSPayment();
  }
}
```

---

### THREEDS_NOT_ENROLLED

**Error Code**: `3DS_NOT_ENROLLED`

**Meaning**: Card not enrolled in 3D Secure program

**Solutions**:

```javascript
// This is normal - proceed without 3DS
if (response.status === 'SUCCEEDED') {
  // Payment succeeded without 3DS
  completeOrder();
}
```

---

## Server Errors

### INTERNAL_SERVER_ERROR (500)

**Solutions**:

```javascript
// Implement retry logic
async function retryOnServerError(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.status >= 500 && i < maxRetries - 1) {
        // Exponential backoff
        await sleep(Math.pow(2, i) * 1000);
        continue;
      }
      throw error;
    }
  }
}
```

<Warning>
If you see persistent 500 errors, check [Status Page](/resources/status) or contact support with the request ID.
</Warning>

---

## Debugging Tips

### 1. Check Request ID

Every API response includes a unique request ID:

```json
{
  "requestId": "req_abc123xyz",
  "error": {
    "code": "PAYMENT_FAILED",
    "message": "Payment processing failed"
  }
}
```

**Use it when contacting support** for faster resolution.

---

### 2. Enable Logging

```javascript
// Log all API calls in development
const DEBUG = process.env.NODE_ENV === 'development';

async function apiCall(endpoint, options) {
  if (DEBUG) {
    console.log('[API Request]', endpoint, options);
  }
  
  const response = await fetch(endpoint, options);
  const data = await response.json();
  
  if (DEBUG) {
    console.log('[API Response]', data);
  }
  
  return data;
}
```

---

### 3. Validate Before Sending

```javascript
// Client-side validation reduces errors
function validate PaymentRequest(data) {
  const errors = [];
  
  if (!data.merchantId) errors.push('merchantId required');
  if (!data.amount || data.amount <= 0) errors.push('invalid amount');
  if (!data.currency) errors.push('currency required');
  if (!validateCardNumber(data.card.number)) errors.push('invalid card');
  
  if (errors.length > 0) {
   throw new ValidationError(errors);
  }
}
```

---

### 4. Test with Sandbox

Always test error scenarios in sandbox:

```javascript
// Test cards for different scenarios
const testCards = {
  success: '4111111111111111',
  declined: '4000000000000002',
  expired: '4000000000000069',
  insufficientFunds: '4000000000000127',
  invalidCVV: '4000000000000101'
};
```

---

## Error Response Reference

Standard error response format:

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "field": "fieldName",           // Optional: which field caused error
    "details": {...}                // Optional: additional context
  },
  "requestId": "req_abc123xyz",
  "timestamp": "2025-12-19T20:15:30Z"
}
```

---

## Need More Help?

<CardGroup cols={2}>
  <Card title="Payment Failures" icon="credit-card" href="/troubleshooting/payment-failures">
    Detailed payment error guide
  </Card>
  
  <Card title="3DS Issues" icon="shield" href="/troubleshooting/3ds-issues">
    3D Secure troubleshooting
  </Card>
  
  <Card title="Webhook Debugging" icon="webhook" href="/troubleshooting/webhook-debugging">
    Fix webhook delivery issues
  </Card>
  
  <Card title="Contact Support" icon="headset" href="/resources/support">
    Get help from our team
  </Card>
</CardGroup>
