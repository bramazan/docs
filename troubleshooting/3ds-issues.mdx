---
title: 3D Secure Issues
description: Troubleshoot 3D Secure authentication problems
icon: 'shield-halved'
---

# 3D Secure Troubleshooting

Diagnose and resolve 3D Secure (3DS) authentication issues.

## Common 3DS Issues

### Issue 1: 3DS Window Won't Open

**Symptoms**:
- Redirect to 3DS URL fails
- Popup blocked
- Blank page

**Solutions**:

<Tabs>
  <Tab title="Popup Blockers">
    **Problem**: Browser blocks 3DS popup
    
    **Solution**:
    ```javascript
    // Open 3DS in same window (recommended)
    if (payment.status === 'REQUIRES_3DS') {
      window.location.href = payment.threeDSecureUrl;
    }
    
    // Or use popup with user gesture
    button.addEventListener('click', async () => {
      const payment = await createPayment();
      if (payment.status === 'REQUIRES_3DS') {
        window.open(payment.threeDSecureUrl, '_blank');
      }
    });
    ```
  </Tab>
  
  <Tab title="CORS Issues">
    **Problem**: Cross-origin errors
    
    **Solution**:
    - Don't use iframe without proper setup
    - Use redirect method instead
    
    ```javascript
    // ❌ Don't use iframe
    iframe.src = payment.threeDSecureUrl;
    
    // ✅ Use redirect
    window.location.href = payment.threeDSecureUrl;
    ```
  </Tab>
  
  <Tab title="Invalid URL">
    **Problem**: Malformed 3DS URL
    
    **Debug**:
    ```javascript
    console.log('3DS URL:', payment.threeDSecureUrl);
    
    // Verify URL is valid
    try {
      new URL(payment.threeDSecureUrl);
    } catch (e) {
      console.error('Invalid 3DS URL');
    }
    ```
  </Tab>
</Tabs>

---

### Issue 2: 3DS Authentication Fails

**Error Code**: `3DS_FAILED`

**Possible Causes**:

<AccordionGroup>
  <Accordion title="Customer Cancelled">
    **Cause**: User clicked "Cancel" on 3DS page
    
    **Handling**:
    ```javascript
    if (error.code === '3DS_FAILED' && error.reason === 'CANCELLED') {
      showMessage('Authentication was cancelled. Please try again.');
      
      // Allow retry
      enableRetryButton();
    }
    ```
  </Accordion>
  
  <Accordion title="Authentication Timeout">
    **Cause**: User didn't complete auth within time limit (typically 5 min)
    
    **Prevention**:
    ```javascript
    // Show countdown timer
    let timeRemaining = 300; // 5 minutes
    
    const timer = setInterval(() => {
      timeRemaining--;
      updateTimer(timeRemaining);
      
      if (timeRemaining === 0) {
        clearInterval(timer);
        showError('Authentication timed out');
      }
    }, 1000);
    ```
  </Accordion>
  
  <Accordion title="Wrong Password/OTP">
    **Cause**: Customer entered wrong credentials
    
    **Handling**:
    ```javascript
    if (error.code === '3DS_FAILED' && error.reason === 'INVALID_CREDENTIALS') {
      showError('Authentication failed. Please verify your credentials with your bank.');
    }
    ```
  </Accordion>
  
  <Accordion title="Bank System Error">
    **Cause**: Bank's 3DS system is down or malfunctioning
    
    **Handling**:
    ```javascript
    if (error.code === '3DS_SYSTEM_ERROR') {
      showError('Bank authentication system is temporarily unavailable. Please try again later or use a different card.');
      
      // Log for monitoring
      logBankError(error.bankCode);
    }
    ```
  </Accordion>
</AccordionGroup>

---

### Issue 3: 3DS Callback Not Received

**Symptoms**:
- 3DS window closes but no callback
- User redirected but payment status unknown

**Solutions**:

<Steps>
  <Step title="Verify Callback URL">
    Ensure callback URL is correctly configured:
    
    ```javascript
    const payment = await createPayment({
      merchantId: 'merchant-123',
      amount: 100.00,
      returnUrl: 'https://yoursite.com/payment/callback', // Must be HTTPS
      callbackUrl: 'https://yoursite.com/api/payment/webhook'
    });
    ```
    
    **Requirements**:
    - Must be HTTPS (except localhost in test)
    - Must be publicly accessible
    - Must respond quickly (< 30s)
  </Step>
  
  <Step title="Handle Callback">
    ```javascript
    // Callback endpoint
    app.get('/payment/callback', async (req, res) => {
      const { paymentId, status, threeDSecureResult } = req.query;
      
      // Verify 3DS result
      const verified = await fetch(
        `https://api.odeal.com/v1/payments/${paymentId}/verify-3ds`,
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ threeDSecureResult })
        }
      );
      
      const result = await verified.json();
      
      if (result.status === 'SUCCEEDED') {
        res.redirect('/success');
      } else {
        res.redirect('/failed');
      }
    });
    ```
  </Step>
  
  <Step title="Implement Polling Fallback">
    If callback might be missed:
    
    ```javascript
    async function waitForPaymentStatus(paymentId, maxAttempts = 20) {
      for (let i = 0; i < maxAttempts; i++) {
        const payment = await fetchPayment(paymentId);
        
        if (payment.status !== 'PROCESSING') {
          return payment;
        }
        
        await sleep(3000); // Wait 3s between polls
      }
      
      throw new Error('Payment status check timeout');
    }
    ```
  </Step>
</Steps>

---

### Issue 4: Mobile 3DS Problems

**Common Issues**:

<Tabs>
  <Tab title="Mobile Browser Issues">
    **Problem**: 3DS doesn't work on mobile browsers
    
    **Solutions**:
    - Ensure viewport meta tag is set
    - Use mobile-optimized 3DS flow
    - Test on actual devices
    
    ```html
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    ```
  </Tab>
  
  <Tab title="App Webview Issues">
    **Problem**: 3DS fails in mobile app WebView
    
    **iOS Solution**:
    ```swift
    // Enable JavaScript
    webView.configuration.preferences.javaScriptEnabled = true
    
    // Allow window.open
    webView.configuration.preferences.javaScriptCanOpenWindowsAutomatically = true
    ```
    
    **Android Solution**:
    ```kotlin
    webView.settings.javaScriptEnabled = true
    webView.settings.domStorageEnabled = true
    webView.settings.setSupportMultipleWindows(true)
    ```
  </Tab>
  
  <Tab title="Deep Link Return">
    **Problem**: Can't return to app after 3DS
    
    **Solution**: Use custom URL scheme
    
    ```javascript
    const payment = await createPayment({
      returnUrl: 'yourapp://payment/callback?paymentId=' + paymentId
    });
    ```
  </Tab>
</Tabs>

---

## Testing 3D Secure

### Test Cards

| Card Number | 3DS Behavior |
|-------------|--------------|
| 4000000000000010 | Requires 3DS - Success |
| 4000000000000028 | Requires 3DS - Failed |
| 4000000000000051 | 3DS Challenge |
| 4111111111111111 | No 3DS (frictionless) |

### Test Flow

```javascript
// Complete 3DS test
async function test3DS() {
  // 1. Create payment
  const payment = await createPayment({
    card: { number: '4000000000000010' }
  });
  
  console.assert(payment.status === 'REQUIRES_3DS');
  console.assert(payment.threeDSecureUrl);
  
  // 2. Redirect to 3DS
  // (In test, click "Authenticate" button)
  
  // 3. Handle callback
  const verified = await verify3DS(payment.id, threeDSecureResult);
  
  console.assert(verified.status === 'SUCCEEDED');
}
```

---

## Monitoring 3DS

### Track 3DS Completion Rate

```javascript
const metrics = {
  initiated: 0,
  completed: 0,
  failed: 0,
  cancelled: 0
};

function track3DS(event, payment) {
  switch (event) {
    case '3ds_initiated':
      metrics.initiated++;
      break;
    case '3ds_completed':
      metrics.completed++;
      break;
    case '3ds_failed':
      metrics.failed++;
      break;
    case '3ds_cancelled':
      metrics.cancelled++;
      break;
  }
  
  const completionRate = metrics.completed / metrics.initiated;
  
  // Alert if completion rate < 70%
  if (completionRate < 0.7) {
    alertOps('Low 3DS completion rate:', completionRate);
  }
}
```

---

##Best Practices

<AccordionGroup>
  <Accordion title="Provide Clear Instructions">
    ```javascript
    if (payment.status === 'REQUIRES_3DS') {
      showModal({
        title: 'Secure Authentication Required',
        message: 'You will be redirected to your bank to verify this payment. Please have your phone ready for SMS verification.',
        button: 'Continue to Bank'
      });
    }
    ```
  </Accordion>
  
  <Accordion title="Save State Before Redirect">
    ```javascript
    // Save payment state
    sessionStorage.setItem('pendingPayment', JSON.stringify({
      paymentId: payment.id,
      orderId: order.id,
      amount: payment.amount,
      timestamp: Date.now()
    }));
    
    // Redirect to 3DS
    window.location.href = payment.threeDSecureUrl;
    
    // On callback, restore state
    const pending = JSON.parse(sessionStorage.getItem('pendingPayment'));
    ```
  </Accordion>
  
  <Accordion title="Handle All Outcomes">
    ```javascript
    function handle3DSResult(result) {
      switch (result.status) {
        case 'SUCCEEDED':
          showSuccess('Payment completed!');
          redirectToConfirmation();
          break;
          
        case 'FAILED':
          if (result.error.code === '3DS_CANCELLED') {
            showWarning('Authentication cancelled. Try again?');
            enableRetry();
          } else {
            showError('Authentication failed. Please try a different card.');
          }
          break;
          
        case 'PROCESSING':
          showLoading('Verifying payment...');
          pollPaymentStatus(result.id);
          break;
      }
    }
    ```
  </Accordion>
  
  <Accordion title="Test on Real Devices">
    - Test on iOS Safari
    - Test on Android Chrome
    - Test in app WebViews
    - Test with different networks (4G, WiFi)
  </Accordion>
</AccordionGroup>

---

## Next Steps

<CardGroup cols={2}>
  <Card title="3DS Integration Guide" icon="shield" href="/features/3ds-integration">
    Complete 3D Secure implementation guide
  </Card>
  
  <Card title="Common Errors" icon="triangle-exclamation" href="/troubleshooting/common-errors">
    Other common errors and solutions
  </Card>
  
  <Card title="Testing Guide" icon="flask" href="/guides/testing">
    Test your integration
  </Card>
  
  <Card title="Support" icon="headset" href="/resources/support">
    Contact support team
  </Card>
</CardGroup>
