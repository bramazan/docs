---
title: Kimlik Doğrulama
description: API isteklerinizi API anahtarı ile güvence altına alın
---

# Kimlik Doğrulama

Ödeal Payment API, güvenli iletişim sağlamak için API anahtarı ve HMAC imzası kullanır.

## API Kimlik Bilgilerini Alma

<Steps>
  <Step title="Destek ile İletişime Geçin">
    API kimlik bilgileri talep etmek için support@odeal.com adresine e-posta gönderin
  </Step>
  
  <Step title="Kimlik Bilgilerini Alın">
    Size şunlar sağlanacaktır:
    - API Anahtarı (istek header'ı için)
    - API Secret'ı (istekleri imzalamak için)
    - Merchant ID
  </Step>
  
  <Step title="Güvenli Bir Şekilde Saklayın">
    Kimlik bilgilerinizi güvenli bir şekilde saklayın (environment variables, secure vault)
  </Step>
</Steps>

<Warning>
API kimlik bilgilerinizi asla version control'e commit etmeyin veya client-side kodda göstermeyin.
</Warning>

---

## Kimlik Doğrulamalı İstekler Yapma

### Temel Kimlik Doğrulama

API anahtarınızı `Authorization` header'ına ekleyin:

```http
POST /v1/payments HTTP/1.1
Host: api.odeal.com.tr
Authorization: Bearer API_ANAHTARINIZ
Content-Type: application/json
```

### Örnek Kod

<CodeGroup>
```javascript Node.js
const axios = require('axios');

const response = await axios.post(
  'https://api.odeal.com.tr/v1/payments',
  {
    amount: 10000,
    currency: 'TRY'
  },
  {
    headers: {
      'Authorization': `Bearer ${process.env.ODEAL_API_KEY}`,
      'Content-Type': 'application/json',
      'X-Idempotency-Key': crypto.randomUUID()
    }
  }
);
```

```python Python
import requests
import os
import uuid

headers = {
    'Authorization': f'Bearer {os.environ["ODEAL_API_KEY"]}',
    'Content-Type': 'application/json',
    'X-Idempotency-Key': str(uuid.uuid4())
}

response = requests.post(
    'https://api.odeal.com.tr/v1/payments',
    json={'amount': 10000, 'currency': 'TRY'},
    headers=headers
)
```

```php PHP
<?php
$apiKey = getenv('ODEAL_API_KEY');

$ch = curl_init('https://api.odeal.com.tr/v1/payments');
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Authorization: Bearer ' . $apiKey,
    'Content-Type: application/json',
    'X-Idempotency-Key: ' . uniqid()
]);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode([
    'amount' => 10000,
    'currency' => 'TRY'
]));

$response = curl_exec($ch);
?>
```

```csharp C#
var client = new HttpClient();
client.DefaultRequestHeaders.Add("Authorization", 
    $"Bearer {Environment.GetEnvironmentVariable("ODEAL_API_KEY")}");
client.DefaultRequestHeaders.Add("X-Idempotency-Key", 
    Guid.NewGuid().ToString());

var response = await client.PostAsJsonAsync(
    "https://api.odeal.com.tr/v1/payments",
    new { amount = 10000, currency = "TRY" }
);
```
</CodeGroup>

---

## HMAC İmzası (İleri Düzey)

Gelişmiş güvenlik için istekleri HMAC-SHA256 ile imzalayın.

### İmza Süreci

1. Canonical string oluştur:
   ```
   {HTTP_METHOD}\n{URI}\n{TIMESTAMP}\n{BODY_JSON}
   ```

2. HMAC imzası üret:
   ```javascript
   const signature = crypto
     .createHmac('sha256', API_SECRET)
     .update(canonicalString)
     .digest('hex');
   ```

3. İstek header'larına ekle:
   ```http
   X-Timestamp: 1642234567
   X-Signature: uretilen_hmac_imzasi
   ```

### Tam Örnek (Node.js)

```javascript
const crypto = require('crypto');

function signRequest(method, uri, timestamp, body, apiSecret) {
  const canonical = `${method}\n${uri}\n${timestamp}\n${JSON.stringify(body)}`;
  return crypto
    .createHmac('sha256', apiSecret)
    .update(canonical)
    .digest('hex');
}

// Kullanım
const timestamp = Math.floor(Date.now() / 1000);
const body = { amount: 10000, currency: 'TRY' };
const signature = signRequest('POST', '/v1/payments', timestamp, body, API_SECRET);

// İmzalı istek yap
await axios.post(url, body, {
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'X-Timestamp': timestamp,
    'X-Signature': signature
  }
});
```

---

## Ortama Özel Anahtarlar

Farklı ortamlar için farklı anahtarlar kullanın:

| Ortam | Amaç |
|-------|------|
| **Sandbox** | Test ve geliştirme |
| **Production** | Canlı işlemler |

<Tip>
Entegrasyonunuzu canlıya almadan önce mutlaka sandbox'ta test edin!
</Tip>

---

## Idempotency

Duplike ücretlendirmeleri önlemek için `X-Idempotency-Key` ekleyin:

```http
X-Idempotency-Key: 550e8400-e29b-41d4-a716-446655440000
```

<Note>
Idempotency key'leri için UUID v4 kullanın. Key'ler 24 saat geçerlidir.
</Note>

Detaylar için [Idempotency Rehberi](/essentials/idempotency) sayfasına bakın.

---

## Hata Yanıtları

### 401 Unauthorized

```json
{
  "errorCode": "UNAUTHORIZED",
  "message": "Geçersiz API anahtarı"
}
```

**Çözüm**: API anahtarının doğru ve süresi dolmamış olduğunu kontrol edin.

### 403 Forbidden

```json
{
  "errorCode": "FORBIDDEN",
  "message": "Bu işlem için yetersiz izinler"
}
```

**Çözüm**: Hesap izinlerinizi doğrulamak için destek ile iletişime geçin.

---

## Güvenlik En İyi Uygulamalar

<CardGroup cols={2}>
  <Card title="Environment Variables Kullan" icon="lock">
    Kimlik bilgilerini asla hard-code etmeyin
  </Card>
  
  <Card title="Anahtarları Düzenli Yenileyin" icon="rotate">
    API anahtarlarını periyodik olarak değiştirin
  </Card>
  
  <Card title="Sadece HTTPS Kullanın" icon="shield">
    Asla HTTP üzerinden istek yapmayın
  </Card>
  
  <Card title="API Kullanımını İzleyin" icon="chart-line">
    Olağandışı aktiviteleri takip edin
  </Card>
</CardGroup>

---

## Kimlik Doğrulamayı Test Etme

Kimlik doğrulama kurulumunuzu test edin:

```bash
curl -X GET \
  https://api.odeal.com.tr/v1/merchants/me \
  -H 'Authorization: Bearer API_ANAHTARINIZ'
```

Beklenen yanıt:
```json
{
  "id": "mrc_abc123",
  "name": "İşletmeniz",
  "status": "active"
}
```

---

## Rate Limiting

Kimlik doğrulama header'ları aynı zamanda rate limitlerini belirler:

```http
X-RateLimit-Limit: 300
X-RateLimit-Remaining: 285
X-RateLimit-Reset: 1642234800
```

Detaylar için [Rate Limiting](/essentials/rate-limiting) sayfasına bakın.
